
*05*	 Merging files

This chapter tells how to merge two file which differ using vim.

|05_1|	Viewing diff
|05_2|	Diffing in vim
|05_3|	Scroll binding
|05_4|	Jumping to changes
|05_5|	Removing changes


===========================================================================
*05_1*	Viewing diff

There is a special way to start Vim, which shows the differences between two
files.  Let's take a file "main.c" and insert a few characters in one line.
Write this file with the 'backup' option set, so that the backup file
"main.c~" will contain the previous version of the file.

Type this command in a shell (not in Vim): >

	vimdiff main.c~ main.c
	vim -d main.c~ main.c

Vim will start, with two windows side by side.  You will only see the line
in which you added characters, and a few lines above and below it.

	 VV		      VV
	+-----------------------------------------+
	|+ +--123 lines: /* a|+ +--123 lines: /* a|  <- fold
	|  text		     |	text		  |
	|  text		     |	text		  |
	|  text		     |	text		  |
	|  text		     |	changed text	  |  <- changed line
	|  text		     |	text		  |
	|  text		     |	------------------|  <- deleted line
	|  text		     |	text		  |
	|  text		     |	text		  |
	|  text		     |	text		  |
	|+ +--432 lines: text|+ +--432 lines: text|  <- fold
	|  ~		     |	~		  |
	|  ~		     |	~		  |
	|main.c~==============main.c==============|
	|					  |
	+-----------------------------------------+

(This picture doesn't show the highlighting, use the vimdiff command for a
better look.)

The lines that were not modified have been collapsed into one line.  This is
called a closed fold.  The are indicated in the picture with "<- fold".
Thus the single fold line at the top stands for 123 text lines.  These lines
are equal in both files.

The line marked with "<- changed line" is highlighted, and the inserted text
is displayed with another color.  This clearly shows what the difference is
between the two files.

The line that was deleted is displayed with "---" in the main.c window.  See
the "<- deleted line" marker in the picture.  These characters are not
really there.  They just fill up main.c, so that it displays the same number
of lines as the other window.


The fold column ~

Each window has a column on the left with a slightly different background.
In the picture above these are indicated with "VV".  You notice there is a
plus character there, in front of each closed fold.  Move the mouse pointer
to that plus and click the left button.  The fold will open, and you can see
the text that it contains.

The fold column contains a minus sign for an open fold.  If you click on
this -, the fold will close.

Obviously, this only works when you have a working mouse.  You can also use
"zo" to open a fold and "zc" to close it.

===========================================================================
*05_2*	Diffing in vim

Another way to start in diff mode can be done from inside Vim.  Edit the
"main.c" file, then make a split and show the differences: >

	:edit main.c
	:vertical diffsplit main.c~

The ":vertical" command is used to make the window split vertically.  If you
omit this, you will get a horizontal split.

If you have a patch or diff file, you can use the third way to start diff
mode.  First edit the file to which the patch applies.  Then tell Vim the
name of the patch file: >

	:edit main.c
	:vertical diffpatch main.c.diff

WARNING: The patch file must contain only one patch, for the file you are
editing.  Otherwise you will get a lot of error messages, and some files
might be patched unexpectedly.

The patching will only be done to the copy of the file in Vim.  The file on
your harddisk will remain unmodified (until you decide to write the file).


===========================================================================
*05_3*	Scroll binding

When the files have more changes, you can scroll in the usual way.  Vim will
try to keep both the windows start at the same position, so you can easily
see the differences side by side.

When you don't want this for a moment, use this command: >

	:set noscrollbind


===========================================================================
*05_4*	Jumping to changes

When you have disabled folding in some way, it may be difficult to find the
changes.  Use this command to jump forward to the next change: >

	]c

To go the other way use: >

	[c

Prepended a count to jump further away.


===========================================================================
*05_5*	Removing changes

You can move text from one window to the other.  This either removes
differences or adds new ones.  Vim doesn't keep the highlighting updated in
all situations.  To update it use this command: >

	:diffupdate

To remove a difference, you can move the text in a highlighted block from one
window to another.  Take the "main.c" and "main.c~" example above.  Move the
cursor to the left window, on the line that was deleted in the other window.
Now type this command: >

	dp
	:diffput

The change will be removed by putting the text of the current window in the
other window.  "dp" stands for "diff put".

You can also do it the other way around.  Move the cursor to the right
window, to the line where "changed" was inserted.  Now type this command: >

	do
	:diffget

The change will now be removed by getting the text from the other window.
Since there are no changes left now, Vim puts all text in a closed fold.
"do" stands for "diff obtain".  "dg" would have been better, but that
already has a different meaning ("dgg" deletes from the cursor until the
first line).


===========================================================================

vim:ft=help:tw=76:ts=8:nomodifiable
